import{S as C,s as M,h as k,g as N,n as E,u as K,r as p,b as R,d as T,a as q,j as n}from"./main-DSryKTGd.js";import{u as A}from"./useQuery-D4p-lK_q.js";import"./preload-helper-PPVm8Dsz.js";var D=class extends C{#e;#i=void 0;#t;#s;constructor(t,e){super(),this.#e=t,this.setOptions(e),this.bindMethods(),this.#o()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#e.defaultMutationOptions(t),M(this.options,e)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),e?.mutationKey&&this.options.mutationKey&&k(e.mutationKey)!==k(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#o(),this.#r(t)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#o(),this.#r()}mutate(t,e){return this.#s=e,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(t)}#o(){const t=this.#t?.state??N();this.#i={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#r(t){E.batch(()=>{if(this.#s&&this.hasListeners()){const e=this.#i.variables,i=this.#i.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#s.onSuccess?.(t.data,e,i,s),this.#s.onSettled?.(t.data,null,e,i,s)):t?.type==="error"&&(this.#s.onError?.(t.error,e,i,s),this.#s.onSettled?.(void 0,t.error,e,i,s))}this.listeners.forEach(e=>{e(this.#i)})})}};function Q(t,e){const i=K(),[s]=p.useState(()=>new D(i,t));p.useEffect(()=>{s.setOptions(t)},[s,t]);const r=p.useSyncExternalStore(p.useCallback(a=>s.subscribe(E.batchCalls(a)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),l=p.useCallback((a,o)=>{s.mutate(a,o).catch(R)},[s]);if(r.error&&T(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:l,mutateAsync:r.mutate}}function z(){const t=q.c(30);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=["todos"],t[0]=e):e=t[0];let i;t[1]===Symbol.for("react.memo_cache_sentinel")?(i={queryKey:e,queryFn:I,initialData:[]},t[1]=i):i=t[1];const{data:s,refetch:r}=A(i);let l;t[2]!==r?(l={mutationFn:U,onSuccess:()=>r()},t[2]=r,t[3]=l):l=t[3];const{mutate:a}=Q(l),[o,j]=p.useState("");let y;t[4]!==a||t[5]!==o?(y=async()=>{await a(o),j("")},t[4]=a,t[5]=o,t[6]=y):y=t[6];const u=y;let x;t[7]===Symbol.for("react.memo_cache_sentinel")?(x={backgroundImage:"radial-gradient(50% 50% at 80% 20%, #3B021F 0%, #7B1028 60%, #1A000A 100%)"},t[7]=x):x=t[7];let g;t[8]===Symbol.for("react.memo_cache_sentinel")?(g=n.jsx("h1",{className:"text-2xl mb-4",children:"TanStack Query Todos list"}),t[8]=g):g=t[8];let c;t[9]!==s?(c=s?.map(F),t[9]=s,t[10]=c):c=t[10];let h;t[11]!==c?(h=n.jsx("ul",{className:"mb-4 space-y-2",children:c}),t[11]=c,t[12]=h):h=t[12];let v;t[13]===Symbol.for("react.memo_cache_sentinel")?(v=_=>j(_.target.value),t[13]=v):v=t[13];let d;t[14]!==u?(d=_=>{_.key==="Enter"&&u()},t[14]=u,t[15]=d):d=t[15];let m;t[16]!==d||t[17]!==o?(m=n.jsx("input",{type:"text",value:o,onChange:v,onKeyDown:d,placeholder:"Enter a new todo...",className:"w-full px-4 py-3 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"}),t[16]=d,t[17]=o,t[18]=m):m=t[18];let w;t[19]!==o?(w=o.trim(),t[19]=o,t[20]=w):w=t[20];const O=w.length===0;let b;t[21]!==u||t[22]!==O?(b=n.jsx("button",{disabled:O,onClick:u,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-blue-500/50 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-lg transition-colors",children:"Add todo"}),t[21]=u,t[22]=O,t[23]=b):b=t[23];let f;t[24]!==m||t[25]!==b?(f=n.jsxs("div",{className:"flex flex-col gap-2",children:[m,b]}),t[24]=m,t[25]=b,t[26]=f):f=t[26];let S;return t[27]!==f||t[28]!==h?(S=n.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-black p-4 text-white",style:x,children:n.jsxs("div",{className:"w-full max-w-2xl p-8 rounded-xl backdrop-blur-md bg-black/50 shadow-xl border-8 border-black/10",children:[g,h,f]})}),t[27]=f,t[28]=h,t[29]=S):S=t[29],S}function F(t){return n.jsx("li",{className:"bg-white/10 border border-white/20 rounded-lg p-3 backdrop-blur-sm shadow-md",children:n.jsx("span",{className:"text-lg text-white",children:t.name})},t.id)}function U(t){return fetch("/demo/api/tq-todos",{method:"POST",body:JSON.stringify(t)}).then(B)}function B(t){return t.json()}function I(){return fetch("/demo/api/tq-todos").then(L)}function L(t){return t.json()}export{z as component};
